import{g as S,Y as k,j as e,Q as f,aa as I,ab as b,S as y,ap as j,J as v,aq as P,P as C,ai as T,aj as q,ak as E,am as d}from"./modulepreload-polyfill-1cc1042d.js";import{u as R}from"./useSelect-be856e0f.js";import{D as $,F as O,a as p}from"./page-d7e14537.js";import{u as V,a as N}from"./index-7256f177.js";import{u as G}from"./uploadImage-82d541ff.js";import"./index-26810ad2.js";import"./index-9c2ee1aa.js";import"./index-ae91c890.js";const D=({type:l,data:m,onSave:a})=>{const[h,o]=S.useState(!1),[c]=C.useForm(),g=k();return e.jsxs(e.Fragment,{children:[e.jsx(v,{icon:e.jsx(b,{name:"setting"}),variant:"outline",onClick:()=>o(!0),disabled:!(l!=null&&l.ParamsRender)}),e.jsx($,{header:g("magic.setting",{ns:"extend"}),visible:h,onClose:()=>o(!1),closeOnOverlayClick:!1,onConfirm:()=>{a(c.getFieldsValue(!0)),o(!1)},destroyOnClose:!0,children:e.jsx(C,{form:c,labelAlign:"top",initialData:m,children:(l==null?void 0:l.ParamsRender)&&e.jsx(l.ParamsRender,{form:c})})})]})},u=(l,m)=>{const a=m.split("-"),h=(o,c)=>{const g=c.shift(),r=o[g];return c.length?h(r.child,c):{list:o,index:g,item:r}};return h(l,a)},F=(l,m="")=>l.map((a,h)=>{var o;return a.key=`${m}${m?"-":""}${h}`,(o=a.child)!=null&&o.length&&(a.child=F(a.child,a.key)),a}),L=({...l})=>{const[m,a]=G(l,{defaultValue:[]}),[h,o]=S.useState([]),{items:c,itemsIndex:g}=V(),r=k(),K=[{colKey:"label",title:r("magic.column.label",{ns:"extend"}),minWidth:400,className:"magic-td",cell:({row:s})=>e.jsx("div",{className:"magic-td-input",children:e.jsx(f,{className:"",value:s.label,onChange:t=>{a(i=>{const{item:n}=u(i,s.key);return n.label=t,[...i]})}})})},{colKey:"name",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:r("magic.column.name",{ns:"extend"})}),e.jsx(I,{content:r("magic.column.nameTooltip",{ns:"extend"}),children:e.jsx(b,{name:"help-circle"})})]}),minWidth:150,cell:({row:s})=>e.jsx(f,{value:s.name,onChange:t=>{a(i=>{const{item:n}=u(i,s.key);return n.name=t,[...i]})}})},{colKey:"type",title:r("magic.column.type",{ns:"extend"}),width:300,cell:({row:s})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onChange:t=>{a(i=>{const{item:n}=u(i,s.key);return n.type!=t&&(n.setting={}),g[""+t].child||(n.child=[]),n.type=t,[...i]})},value:s.type,children:c.map((t,i)=>e.jsx(y.Option,{value:t.name,children:t.label},i))}),e.jsx(D,{data:s.setting,onSave:t=>{a(i=>{const{item:n}=u(i,s.key);return n.setting=t,[...i]})},type:c.find(t=>{if(t.name==s.type)return t})})]})},{width:100,align:"center",colKey:"required",title:r("magic.column.required",{ns:"extend"}),cell:({row:s})=>e.jsx(j,{checked:s.required||!1,onChange:t=>{a(i=>{const{item:n}=u(i,s.key);return n.required=t,[...i]})}})},{width:100,align:"center",colKey:"list",title:r("magic.column.list",{ns:"extend"}),cell:({row:s})=>e.jsx(j,{checked:s.list||!1,onChange:t=>{a(i=>{const{item:n}=u(i,s.key);return n.list=t,[...i]})}})},{width:100,align:"center",colKey:"search",title:r("magic.column.search",{ns:"extend"}),cell:({row:s})=>e.jsx(j,{checked:s.search||!1,onChange:t=>{a(i=>{const{item:n}=u(i,s.key);return n.search=t,[...i]})}})},{colKey:"action",fixed:"right",width:150,title:e.jsxs("div",{className:"flex justify-between",children:[r("table.actions")," ",e.jsx(v,{icon:e.jsx(b,{name:"plus"}),size:"small",variant:"outline",onClick:()=>{a(s=>[...s||[],{type:"text",setting:{},key:`${(s==null?void 0:s.length)||0}`}])}})]}),cell:({row:s})=>{const t=g[s.type];return e.jsxs("div",{className:"flex justify-center gap-4",children:[t.child&&e.jsx(N,{theme:"primary",onClick:()=>{a(i=>{const{item:n}=u(i,s.key);return n.child=n.child||[],typeof t.child=="object"&&t.child.max&&n.child.length>=t.child.max?i:(n.child.length===0&&o(x=>x.includes(s.key)?x:(x.push(s.key),[...x])),n.child.push({type:"text",setting:{},key:`${s.key}-${n.child.length}`}),[...i])})},children:r("buttons.create")}),e.jsx(N,{theme:"danger",onClick:()=>{a(i=>{const{list:n,index:x}=u(i,s.key);return n.splice(x,1),F(i)})},children:r("buttons.delete")})]})}}];return e.jsx(P,{rowKey:"key",columns:K,data:m||[],bordered:!0,tree:{childrenKey:"child",treeNodeColumnIndex:0},expandedTreeNodes:h,onExpandedTreeNodesChange:s=>o(s)})},Y=()=>{const l=k(),{id:m}=T(),{options:a,onSearch:h,queryResult:o}=R({resource:"tools.magicGroup",optionLabel:"label",optionValue:"id"});return e.jsxs(O,{formProps:{labelAlign:"top"},back:!0,id:m,initFormat:c=>(c.image=q(c.image),c),saveFormat:c=>(c.image=E(c.image),c),children:[e.jsx(p,{name:"group_id",label:l("tools.magic.fields.group"),help:l("tools.magic.help.group"),children:e.jsx(y,{filterable:!0,clearable:!0,onSearch:h,options:a,placeholder:l("tools.magic.placeholder.group"),loading:o.isLoading})}),e.jsx(p,{name:"label",label:l("tools.magic.fields.label"),help:l("tools.magic.fields.labelDesc"),children:e.jsx(f,{placeholder:l("tools.magic.validate.label")})}),e.jsx(p,{name:"name",label:l("tools.magic.fields.name"),help:l("tools.magic.fields.nameDesc"),children:e.jsx(f,{placeholder:l("tools.magic.validate.name")})}),e.jsx(p,{name:"type",label:l("tools.magic.fields.type"),help:l("tools.magic.fields.typeDesc"),initialData:"common",children:e.jsxs(d.Group,{children:[e.jsx(d,{value:"common",children:l("tools.magic.fields.list")}),e.jsx(d,{value:"pages",children:l("tools.magic.fields.pages")}),e.jsx(d,{value:"tree",children:l("tools.magic.fields.tree")}),e.jsx(d,{value:"page",children:l("tools.magic.fields.page")})]})}),e.jsx(p,{name:"external",label:l("tools.magic.fields.external"),help:l("tools.magic.fields.externalDesc"),initialData:0,children:e.jsxs(d.Group,{children:[e.jsx(d,{value:0,children:l("tools.magic.fields.public")}),e.jsx(d,{value:1,children:l("tools.magic.fields.private")})]})}),e.jsx(p,{name:"page",label:l("tools.magic.fields.option"),help:l("tools.magic.fields.optionDesc"),initialData:0,children:e.jsxs(d.Group,{children:[e.jsx(d,{value:0,children:l("tools.magic.fields.modal")}),e.jsx(d,{value:1,children:l("tools.magic.fields.page")})]})}),e.jsx(p,{name:"fields",label:l("tools.magic.fields.fields"),help:l("tools.magic.fields.fieldsDesc"),children:e.jsx(L,{})})]})};export{Y as default};
