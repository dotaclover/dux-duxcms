import{j as e}from"./vendor-map-xrlPGoMd.js";import{_ as C,W as S}from"./vendor-refine-BPS4QmKj.js";import{G as O}from"./modulepreload-polyfill-FQPaZMP9.js";import{r as F}from"./vendor-react-CEAiij2-.js";import"./vendor-echarts-BA2V57Gb.js";import{I as y,a6 as b,n as j,S as p,$ as k,B as T,x as N,P,F as v,ai as R,R as d}from"./vendor-tdesign-CDUa2Lvz.js";import{F as $,a as u}from"./page-BZ0b5xrd.js";import{f as E,g as G}from"./useUpload-BbSe5Hcu.js";import"./vendor-tinymce-DBANSpiv.js";import"./vendor-lib-DkJHNO_p.js";import{u as q}from"./useSelect-CHkdsRnl.js";import{u as L}from"./index-O7P1qK8T.js";import"./vendor-markdown-DKT2DIHL.js";import"./cascader-5lOqLYKR.js";import"./uploadImage-BDM88I0H.js";import"./uploadFile-DxEqfc2Y.js";import"./tinymce-iCxC44fp.js";import"./manage-B3i6o4zW.js";const V=({type:l,data:m,onSave:a})=>{const[x,r]=F.useState(!1),[c]=v.useForm(),g=C();return e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:e.jsx(j,{name:"setting"}),variant:"outline",onClick:()=>r(!0),disabled:!(l!=null&&l.ParamsRender)}),e.jsx(R,{header:g("magic.setting",{ns:"extend"}),visible:x,onClose:()=>r(!1),closeOnOverlayClick:!1,onConfirm:()=>{a(c.getFieldsValue(!0)),r(!1)},destroyOnClose:!0,children:e.jsx(v,{form:c,labelAlign:"top",initialData:m,children:(l==null?void 0:l.ParamsRender)&&e.jsx(l.ParamsRender,{form:c})})})]})},h=(l,m)=>{const a=m.split("-"),x=(r,c)=>{const g=c.shift(),o=r[g];return c.length?x(o.child,c):{list:r,index:g,item:o}};return x(l,a)},I=(l,m="")=>l.map((a,x)=>{var r;return a.key=`${m}${m?"-":""}${x}`,(r=a.child)!=null&&r.length&&(a.child=I(a.child,a.key)),a}),W=({...l})=>{const[m,a]=O(l,{defaultValue:[]}),[x,r]=F.useState([]),{items:c,itemsIndex:g}=L(),o=C(),K=[{colKey:"label",title:o("magic.column.label",{ns:"extend"}),minWidth:400,className:"magic-td",cell:({row:t})=>e.jsx("div",{className:"magic-td-input",children:e.jsx(y,{className:"",value:t.label,onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.label=n,[...i]})}})})},{colKey:"name",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:o("magic.column.name",{ns:"extend"})}),e.jsx(b,{content:o("magic.column.nameTooltip",{ns:"extend"}),children:e.jsx(j,{name:"help-circle"})})]}),minWidth:150,cell:({row:t})=>e.jsx(y,{value:t.name,onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.name=n,[...i]})}})},{colKey:"type",title:o("magic.column.type",{ns:"extend"}),width:300,cell:({row:t})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.type!=n&&(s.setting={}),g[""+n].child||(s.child=[]),s.type=n,[...i]})},value:t.type,children:c.map((n,i)=>e.jsx(p.Option,{value:n.name,children:n.label},i))}),e.jsx(V,{data:t.setting,onSave:n=>{a(i=>{const{item:s}=h(i,t.key);return s.setting=n,[...i]})},type:c.find(n=>{if(n.name==t.type)return n})})]})},{width:100,align:"center",colKey:"required",title:o("magic.column.required",{ns:"extend"}),cell:({row:t})=>e.jsx(k,{checked:t.required||!1,onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.required=n,[...i]})}})},{width:100,align:"center",colKey:"list",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:o("magic.column.list",{ns:"extend"})}),e.jsx(b,{content:o("magic.column.listTooltip",{ns:"extend"}),children:e.jsx(j,{name:"help-circle"})})]}),cell:({row:t})=>e.jsx(k,{checked:t.list||!1,onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.list=n,[...i]})}})},{width:100,align:"center",colKey:"search",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:o("magic.column.search",{ns:"extend"})}),e.jsx(b,{content:o("magic.column.searchTooltip",{ns:"extend"}),children:e.jsx(j,{name:"help-circle"})})]}),cell:({row:t})=>e.jsx(k,{checked:t.search||!1,onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.search=n,[...i]})}})},{width:130,align:"center",colKey:"external",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:o("magic.column.external",{ns:"extend"})}),e.jsx(b,{content:o("magic.column.externalTooltip",{ns:"extend"}),children:e.jsx(j,{name:"help-circle"})})]}),cell:({row:t})=>e.jsxs(p,{value:t.external||"empty",onChange:n=>{a(i=>{const{item:s}=h(i,t.key);return s.external=n,[...i]})},children:[e.jsx(p.Option,{value:"empty",children:o("magic.external.empty",{ns:"extend"})}),e.jsx(p.Option,{value:"read",children:o("magic.external.read",{ns:"extend"})}),e.jsx(p.Option,{value:"write",children:o("magic.external.write",{ns:"extend"})}),e.jsx(p.Option,{value:"readWrite",children:o("magic.external.readWrite",{ns:"extend"})})]})},{colKey:"action",fixed:"right",width:150,title:e.jsxs("div",{className:"flex justify-between",children:[o("table.actions")," ",e.jsx(T,{icon:e.jsx(j,{name:"plus"}),size:"small",variant:"outline",onClick:()=>{a(t=>[...t||[],{type:"text",setting:{},key:`${(t==null?void 0:t.length)||0}`}])}})]}),cell:({row:t})=>{const n=g[t.type];return e.jsxs("div",{className:"flex justify-center gap-4",children:[n.child&&e.jsx(N,{theme:"primary",onClick:()=>{a(i=>{const{item:s}=h(i,t.key);return s.child=s.child||[],typeof n.child=="object"&&n.child.max&&s.child.length>=n.child.max?i:(s.child.length===0&&r(f=>f.includes(t.key)?f:(f.push(t.key),[...f])),s.child.push({type:"text",setting:{},key:`${t.key}-${s.child.length}`}),[...i])})},children:o("buttons.create")}),e.jsx(N,{theme:"danger",onClick:()=>{a(i=>{const{list:s,index:f}=h(i,t.key);return s.splice(f,1),I(i)})},children:o("buttons.delete")})]})}}];return e.jsx(P,{rowKey:"key",columns:K,data:m||[],bordered:!0,tree:{childrenKey:"child",treeNodeColumnIndex:0},expandedTreeNodes:x,onExpandedTreeNodesChange:t=>r(t)})},ne=()=>{const l=C(),{id:m}=S(),{options:a,onSearch:x,queryResult:r}=q({resource:"tools.magicGroup",optionLabel:"label",optionValue:"id"});return e.jsxs($,{formProps:{labelAlign:"top"},back:!0,id:m,initFormat:c=>(c.image=E(c.image),c),saveFormat:c=>(c.image=G(c.image),c),children:[e.jsx(u,{name:"group_id",label:l("tools.magic.fields.group"),help:l("tools.magic.help.group"),children:e.jsx(p,{filterable:!0,clearable:!0,onSearch:x,options:a,placeholder:l("tools.magic.placeholder.group"),loading:r.isLoading})}),e.jsx(u,{name:"label",label:l("tools.magic.fields.label"),help:l("tools.magic.fields.labelDesc"),children:e.jsx(y,{placeholder:l("tools.magic.validate.label")})}),e.jsx(u,{name:"name",label:l("tools.magic.fields.name"),help:l("tools.magic.fields.nameDesc"),children:e.jsx(y,{placeholder:l("tools.magic.validate.name")})}),e.jsx(u,{name:"page",label:l("tools.magic.fields.option"),help:l("tools.magic.fields.optionDesc"),initialData:0,children:e.jsxs(d.Group,{children:[e.jsx(d,{value:0,children:l("tools.magic.fields.modal")}),e.jsx(d,{value:1,children:l("tools.magic.fields.page")})]})}),e.jsx(u,{name:"type",label:l("tools.magic.fields.type"),help:l("tools.magic.fields.typeDesc"),initialData:"common",children:e.jsxs(d.Group,{children:[e.jsx(d,{value:"common",children:l("tools.magic.fields.list")}),e.jsx(d,{value:"pages",children:l("tools.magic.fields.pages")}),e.jsx(d,{value:"tree",children:l("tools.magic.fields.tree")}),e.jsx(d,{value:"page",children:l("tools.magic.fields.page")})]})}),e.jsx(v.FormItem,{shouldUpdate:(c,g)=>c.type!==g.type,children:({getFieldValue:c})=>c("type")==="tree"?e.jsx(u,{name:"tree_label",label:l("tools.magic.fields.treeLabel"),help:l("tools.magic.fields.treeLabelDesc"),children:e.jsx(y,{})}):e.jsx(e.Fragment,{})}),e.jsx(u,{name:"inline",label:l("tools.magic.fields.affiliate"),help:l("tools.magic.fields.affiliateDesc"),initialData:0,children:e.jsxs(d.Group,{children:[e.jsx(d,{value:0,children:l("tools.magic.fields.independentType")}),e.jsx(d,{value:1,children:l("tools.magic.fields.inlineType")})]})}),e.jsx(u,{name:"external",label:l("tools.magic.fields.external"),help:l("tools.magic.fields.externalDesc"),initialData:0,children:e.jsx(k.Group,{options:[{value:"read",label:l("tools.magic.external.read")},{value:"create",label:l("tools.magic.external.create")},{value:"edit",label:l("tools.magic.external.edit")}]})}),e.jsx(u,{name:"fields",label:l("tools.magic.fields.fields"),help:l("tools.magic.fields.fieldsDesc"),children:e.jsx(W,{})})]})};export{ne as default};
