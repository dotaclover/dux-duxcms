const __vite__fileDeps=["assets/speed-MGQahTS-.js","assets/vendor-map-DjDVTs0N.js","assets/vendor-react-BlTfyhut.js","assets/vendor-tdesign-BxQoi5Mo.js","assets/modulepreload-polyfill-D6ThnDFs.js","assets/vendor-echarts-JHGMnnew.js","assets/vendor-refine-BK41FXO6.js","assets/vendor-tinymce-lUkVC9Da.js","assets/vendor-markdown-CL7ixDl-.js","assets/vendor-lib-CKVa3D7Q.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as V}from"./vendor-markdown-CL7ixDl-.js";import{j as s}from"./vendor-map-DjDVTs0N.js";import{r as l}from"./vendor-react-BlTfyhut.js";import{G as X,ap as Q,P as Y}from"./vendor-refine-BK41FXO6.js";import{t as w,u as Z,M as ee,v as te}from"./modulepreload-polyfill-D6ThnDFs.js";import{b as se}from"./index-DWzSL70G.js";import{P as U,w as ne,B as re,T as ae,U as ie}from"./vendor-tdesign-BxQoi5Mo.js";import{_ as G}from"./vendor-echarts-JHGMnnew.js";import"./vendor-tinymce-lUkVC9Da.js";import"./vendor-lib-CKVa3D7Q.js";function I(a){var t=l.useRef(a);return t.current=a,t}var le=function(a){var t=I(a);l.useEffect(function(){return function(){t.current()}},[])},ce=function(a,t,m){m===void 0&&(m={});var n=w(a),o=l.useRef(null),_=l.useCallback(function(){o.current&&clearInterval(o.current)},[]);return l.useEffect(function(){return m.immediate&&n(),o.current=setInterval(n,t),_},[t,m.immediate]),_},g;(function(a){a[a.Connecting=0]="Connecting",a[a.Open=1]="Open",a[a.Closing=2]="Closing",a[a.Closed=3]="Closed"})(g||(g={}));function oe(a,t){t===void 0&&(t={});var m=t.reconnectLimit,n=m===void 0?3:m,o=t.reconnectInterval,_=o===void 0?3*1e3:o,h=t.manual,O=h===void 0?!1:h,b=t.onOpen,H=t.onClose,J=t.onMessage,R=t.onError,D=t.protocols,z=I(b),x=I(H),N=I(J),k=I(R),C=l.useRef(0),p=l.useRef(),d=l.useRef(),F=G(l.useState(),2),S=F[0],P=F[1],$=G(l.useState(g.Closed),2),q=$[0],E=$[1],T=function(){var r;C.current<n&&((r=d.current)===null||r===void 0?void 0:r.readyState)!==g.Open&&(p.current&&clearTimeout(p.current),p.current=setTimeout(function(){L(),C.current++},_))},L=function(){p.current&&clearTimeout(p.current),d.current&&d.current.close();var r=new WebSocket(a,D);E(g.Connecting),r.onerror=function(f){var u;d.current===r&&(T(),(u=k.current)===null||u===void 0||u.call(k,f,r),E(r.readyState||g.Closed))},r.onopen=function(f){var u;d.current===r&&((u=z.current)===null||u===void 0||u.call(z,f,r),C.current=0,E(r.readyState||g.Open))},r.onmessage=function(f){var u;d.current===r&&((u=N.current)===null||u===void 0||u.call(N,f,r),P(f))},r.onclose=function(f){var u;(u=x.current)===null||u===void 0||u.call(x,f,r),d.current===r&&T(),(!d.current||d.current===r)&&E(r.readyState||g.Closed)},d.current=r},K=function(r){var f;if(q===g.Open)(f=d.current)===null||f===void 0||f.send(r);else throw new Error("WebSocket disconnected")},M=function(){C.current=0,L()},B=function(){var r;p.current&&clearTimeout(p.current),C.current=n,(r=d.current)===null||r===void 0||r.close(),d.current=void 0};return l.useEffect(function(){!O&&a&&M()},[a,O]),le(function(){B()}),{latestMessage:S,sendMessage:w(K),connect:w(M),disconnect:w(B),readyState:q,webSocketIns:d.current}}const he=()=>{var T,L,K,M,B,r,f,u,A;const{request:a}=Z(),t=X(),{data:m}=Q({url:"system/total",method:"get",meta:{params:{}}}),n=m==null?void 0:m.data,[o,_]=l.useState({}),[h,O]=l.useState(!0);ce(()=>{a("system/total/hardware","get").then(e=>{O(!1),_(e.data||[])})},5e3);const[b,H]=l.useState(""),[J,R]=l.useState(!1),[D,z]=l.useState(!1),[x,N]=l.useState([]),[k,C]=l.useState([]),{mutate:p}=Y(),{readyState:d,sendMessage:F,latestMessage:S,disconnect:P,connect:$}=oe("wss://data.cesu.net/v1/ws",{manual:!0,reconnectLimit:0});l.useEffect(()=>{b?(J&&P(),setTimeout(()=>{N([]),$()},500)):P()},[b]),l.useEffect(()=>{b&&(d==1&&(R(!0),F(JSON.stringify({taskId:b}))),d==3&&R(!1))},[d,b]),l.useEffect(()=>{if(!S)return;z(!1);const e=JSON.parse(S==null?void 0:S.data);(e==null?void 0:e.nid)!=0&&(e==null?void 0:e.nid)!=0&&((e==null?void 0:e.code)==200||(e==null?void 0:e.code)==500||(e==null?void 0:e.code)==400)&&N(i=>{var c,v;return[...i,{nid:e==null?void 0:e.nid,time:(c=e==null?void 0:e.data)!=null&&c.success&&((v=e==null?void 0:e.data)!=null&&v.allTime)?Number(e.data.allTime):void 0,info:k==null?void 0:k.find(y=>(y==null?void 0:y.nid)==(e==null?void 0:e.nid))}]})},[S,k]);const q=l.useMemo(()=>(x==null?void 0:x.map(e=>{var i,c,v,y;if((i=e==null?void 0:e.info)!=null&&i.china_province)return{name:(c=e==null?void 0:e.info)==null?void 0:c.province,value:e!=null&&e.time?(y=e==null?void 0:(v=e.time).toFixed)==null?void 0:y.call(v,2):1e3}}).filter(e=>!!e))||[],[x]),E=(e,i)=>{z(!0),p({url:"system/total/speed",method:"post",values:{net:e,token:i}},{onSuccess(c){var v,y;H((v=c.data)==null?void 0:v.taskId),C((y=c.data)==null?void 0:y.nodes)},onError(){z(!1)}})};return s.jsx(ee,{children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(U,{title:s.jsx("div",{className:"flex items-center gap-2",children:t("system.total.general.title")}),headerBordered:!0,children:s.jsxs("div",{className:"grid grid-cols-1 gap-4 2xl:grid-cols-4 md:grid-cols-2",children:[s.jsx(W,{isLoading:h,title:t("system.total.general.cpuLoad"),value:Number((T=o==null?void 0:o.load)==null?void 0:T.toFixed(2)),unit:"%"}),s.jsx(W,{isLoading:h,title:t("system.total.general.cpuUse"),value:Number(o==null?void 0:o.cpu),unit:"%"}),s.jsx(W,{isLoading:h,title:t("system.total.general.memUse"),value:Number(o==null?void 0:o.mem),unit:"%"}),s.jsx(W,{isLoading:h,title:t("system.total.general.diskUse"),value:(o==null?void 0:o.disk)||0,unit:"%"})]})}),s.jsx(U,{title:t("system.total.env.title"),headerBordered:!0,children:s.jsxs("div",{className:"row-4 grid grid-cols-1 w-full gap-4 gap-4 2xl:grid-cols-4 md:grid-cols-2",children:[s.jsx(j,{title:t("system.total.env.php"),value:((L=n==null?void 0:n.sys)==null?void 0:L.php)||"-",icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-brand-2 p-3 text-brand",children:s.jsx("div",{className:"i-tabler:brand-php size-8"})})}),s.jsx(j,{title:t("system.total.env.mysql"),value:((K=n==null?void 0:n.sys)==null?void 0:K.mysql)||"-",icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-success-2 p-3 text-success",children:s.jsx("div",{className:"i-tabler:brand-mysql size-8"})})}),s.jsx(j,{title:t("system.total.env.redis"),value:((M=n==null?void 0:n.sys)==null?void 0:M.redis)||"-",icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-error-2 p-3 text-error",children:s.jsx("div",{className:"i-tabler:database size-8"})})}),s.jsx(j,{title:t("system.total.env.time"),value:"UTC "+((B=n==null?void 0:n.sys)==null?void 0:B.time),icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-warning-2 p-3 text-warning",children:s.jsx("div",{className:"i-tabler:calendar-time size-8"})})}),s.jsx(j,{title:t("system.total.env.gdExt"),value:(r=n==null?void 0:n.extend)!=null&&r.gd?t("system.total.env.on"):t("system.total.env.off"),icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-pink-1 p-3 text-pink-6 dark:bg-pink-9/50 dark:text-pink-7",children:s.jsx("div",{className:"i-tabler:photo size-8"})})}),s.jsx(j,{title:t("system.total.env.imagickExt"),value:(f=n==null?void 0:n.syextends)!=null&&f.imagick?t("system.total.env.on"):t("system.total.env.off"),icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-purple-1 p-3 p-3 text-purple-6 dark:bg-purple-9/50 dark:text-purple-7",children:s.jsx("div",{className:"i-tabler:photo size-8"})})}),s.jsx(j,{title:t("system.total.env.redisExt"),value:(u=n==null?void 0:n.syextends)!=null&&u.redis?t("system.total.env.on"):t("system.total.env.off"),icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-teal-1 p-3 p-3 text-teal-6 dark:bg-teal-9/50 dark:text-teal-7",children:s.jsx("div",{className:"i-tabler:database size-8"})})}),s.jsx(j,{title:t("system.total.env.zipExt"),value:(A=n==null?void 0:n.syextends)!=null&&A.zip?t("system.total.env.on"):t("system.total.env.off"),icon:s.jsx("div",{className:"size-12 flex flex-none items-center justify-center rounded-full bg-yellow-2 p-3 p-3 text-yellow-6 dark:bg-yellow-9/50 dark:text-yellow-7",children:s.jsx("div",{className:"i-tabler:zip size-8"})})})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(U,{title:t("system.total.speed.title"),description:s.jsxs(s.Fragment,{children:[t("system.total.speed.desc"),s.jsx(ne,{href:"https://www.cesu.net/",theme:"primary",target:"_blank",children:t("system.total.speed.view")})]}),headerBordered:!0,actions:s.jsx("div",{children:s.jsx(re,{variant:"outline",onClick:()=>{te.open({title:"站点测速",component:()=>V(()=>import("./speed-MGQahTS-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),componentProps:{onSpeedTest:E}})},loading:D,children:t("system.total.speed.start")})}),children:s.jsx("div",{className:"h-100 w-full",children:s.jsx(se,{name:t("system.total.speed.speed"),params:{min:0,max:10},options:{tooltip:{trigger:"item",formatter:({seriesName:e,value:i})=>{var c;return`${e} ${i<1e3?((c=i==null?void 0:i.toFixed)==null?void 0:c.call(i,2))+"s":t("system.total.speed.timeout")}`}}},data:q,map:"china"})})}),s.jsx(U,{title:t("system.total.area.title"),headerBordered:!0,children:s.jsx(ae,{data:x,rowKey:"nid",maxHeight:420,columns:[{title:t("system.total.area.area"),colKey:"province",cell:({row:e})=>{var i,c;return`${((i=e==null?void 0:e.info)==null?void 0:i.province)||""}${(c=e==null?void 0:e.info)==null?void 0:c.city}`}},{title:t("system.total.area.line"),colKey:"type",cell:({row:e})=>{var i;return(i=e==null?void 0:e.info)==null?void 0:i.type}},{title:t("system.total.area.time"),colKey:"time",sortType:"all",width:200,sorter:!0,cell:({row:e})=>{var i,c;return(e==null?void 0:e.time)<1e3?`${(c=(i=e.time).toFixed)==null?void 0:c.call(i,2)}s`:t("system.total.speed.timeout")}}],onSortChange:e=>{if(!e||!(e!=null&&e.sortBy)){N([...x]);return}const i=x.concat().sort((c,v)=>e.descending?v[e.sortBy]-c[e.sortBy]:c[e.sortBy]-v[e.sortBy]);N([...i])}})})]})]})})},W=({isLoading:a,title:t,value:m,unit:n})=>s.jsx("div",{className:"flex items-start gap-4",children:s.jsx(ie,{title:s.jsx("div",{children:t}),value:m,loading:a,unit:n})}),j=({isLoading:a,title:t,value:m,icon:n})=>s.jsxs("div",{className:"flex gap-4 rounded p-2",children:[n,s.jsxs("div",{className:"flex flex-1 flex-col",children:[s.jsx("div",{className:"text-placeholder",children:t}),s.jsx("div",{className:"text-base font-bold",children:a?"-":m})]})]});export{he as default};
